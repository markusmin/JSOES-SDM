---
title: "JSOES Trawl Data Exploratory Analysis"
author: "Markus Min"
date: "`r Sys.Date()`"
output:
  html_document
---

This page contains exploratory analysis for the trawl data from JSOES.

```{r chunk-options, message = FALSE, echo = FALSE, warning = FALSE}
# set chunk options
knitr::opts_chunk$set(message = FALSE, echo = FALSE, warning = FALSE)
```


```{r load-libraries-reformat-data}
library(readxl)
library(here)
library(janitor)
library(tidyverse)
library(kableExtra)

#### Species data ####
jsoes <- clean_names(read_excel(here::here("Data", "Markus_Min_Trawl_CTD_Chl_Nuts_Thorson_Scheuerell_5.2.24_FINAL.xlsx")))

species_column_names <- colnames(jsoes)[32:ncol(jsoes)]

# change nmi to km to keep units consistent
jsoes %>% 
  mutate(km_from_shore = nmi_from_shore * 1.852) -> jsoes

jsoes %>% 
  pivot_longer(., cols = all_of(species_column_names), values_to = "n_per_km", names_to = "species") %>% 
  mutate(n = n_per_km*trawl_dist_km) -> jsoes_long
```


```{r common_taxa}
## total density
jsoes_long %>% 
  group_by(species) %>% 
  summarise(total_density = sum(n_per_km)) %>% 
  arrange(desc(total_density)) -> jsoes_density_sums

jsoes_density_sums[1:10,] %>% 
  mutate(total_density = round(total_density, 0)) %>% 
  kbl(caption = "Top ten taxa by sum of density.") %>% 
  kable_styling(latex_options = "HOLD_position")

## frequency of occurrence

# get count of each genus_species
jsoes_long %>% 
  filter(n > 0) %>% 
  count(species) %>% 
  arrange(desc(n)) %>% 
  mutate(prop_samples = n/nrow(jsoes)) -> jsoes_freq_occ

jsoes_freq_occ[1:10, ] %>% 
  mutate(prop_samples = round(prop_samples, 2)) %>% 
  kbl(caption = "Top ten taxa by frequency of occurrence.") %>% 
  kable_styling(latex_options = "HOLD_position")

```
